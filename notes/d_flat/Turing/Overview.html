<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Architecture Overview</title>
  <link href="/schemas/page.css" rel="stylesheet"/>
  <link href="/math-block.css" rel="stylesheet"/>
  <link href="/math-inline.css" rel="stylesheet"/>
  <link href="/mathyml.css" rel="stylesheet"/>
  <link href="/inline-fold.css" rel="stylesheet"/>
  <link crossorigin="true" href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css2?family=Inria+Sans:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@700&display=swap" rel="stylesheet">
  
  <link href="/components/sidebar.css" rel="stylesheet">
  <script>
    setInterval(async () => {
      const res = await fetch('/_reload')
      if (await res.text() === '1') {
        location.reload()
      }
    }, 500)
  </script>
  <link href="/rewrite/code_block.css" rel="stylesheet">
  <link href="/rewrite/code_inline.css" rel="stylesheet">
  
  <link href="https://fred-wang.github.io/MathFonts/NewComputerModern/mathfonts.css" rel="stylesheet">
</head>
<body>

  <header class="header" parent="true">
    <nav class="nav">
      <div class="logo">
        <span onclick="window.location.href='/notes/d_flat/Turing'" title="Turing Machine Simulator (R-M) for Project D-Flat [/notes/d_flat/Turing]">« Turing Machine Simulator (R-M) for Project D-Flat</span>
      </div>
    </nav>
  </header>
  <div id="grid-wrapper" sidebar="true">
    <article>
      <section class="block" id="notes/d_flat/Turing/Overview">
        <details open="">
          <summary>
            <header class="top-header" show-metadata="true">
              <h1>
                Architecture Overview 
              </h1>
              <div class="metadata">
                <ul>
                  <li class="meta-item">
                    <span class="link external"><a href="https://github.com/mujiu555" title="https://github.com/mujiu555">GitHub@mujiu555</a></span>
                  </li>
                  <li class="meta-item">
                    2025-12-14 23:46
                  </li>
                  <li class="meta-item">
                    <span class="link local"><a href="https://github.com/mujiu555/Wishful-Thinking/tree/main/site" title="Source [https://github.com/mujiu555/Wishful-Thinking/tree/main/site]">Source</a></span>
                  </li>
                </ul>
              </div>
            </header>
          </summary>
          <p>The virtual machine works in a register-memory architecture.</p>
  <pre color-scheme="light"><code><span style="color:#5c6a72;">File:                                                 Memory:
</span><span style="color:#5c6a72;">+--------------------------------------+      +-------------------------------+
</span><span style="color:#5c6a72;">| Archive                              |      |  +--------------------++++    |
</span><span style="color:#5c6a72;">| +----------+    +---------------+++  |      |  | Global Data Stack  ||||    |
</span><span style="color:#5c6a72;">| | Global   | +-&gt;| Function Unit |||| |      |  |--------------------++++    |
</span><span style="color:#5c6a72;">| | +--+++   | |  | +--+++  +-++  |||| |      |  | Text Vector           |    |
</span><span style="color:#5c6a72;">| | | D |||  | |  | | T ||| |D||| |||| |      |  +-----------------------+    |
</span><span style="color:#5c6a72;">| | | a |||  | |  | | e ||| |a||| ||||==========&gt;| Function Unit Vector  |&lt;-+ |
</span><span style="color:#5c6a72;">| | | t |||  | |  | | x ||| |t||| |||| |      |  | +-------------------++|  | |
</span><span style="color:#5c6a72;">| | | a |||  | |  | | t ||| |a||| |||| |      |  | | +---------------+ |||  | |
</span><span style="color:#5c6a72;">| | +--+++   | |  | +--+++  +-++  |||| |      |  | | | Data Vector   | |||  | |
</span><span style="color:#5c6a72;">| | +--+++   | |  | +--+++  +-++  |||| |      |  | | | +---------+++ | |||  | |
</span><span style="color:#5c6a72;">| | | E |||  | |  | | C ||| |C||| |||| |      |  | | | | Literal ||| | |||  | |
</span><span style="color:#5c6a72;">| | | n |||  | |  | | o ||| |l||| |||| |      |  | | | +---------+++ | |||  | |
</span><span style="color:#5c6a72;">| | | t -------+  | | s ||| |o||| |||| |      |  | | | | capture ||| | |||  | |
</span><span style="color:#5c6a72;">| | | e |||  |    | | t ||| |s||| |||| | Load |  | | | +---------+++ | |||  | |
</span><span style="color:#5c6a72;">| | | r |||  |    | | a ||| |u||| |||| | ===&gt; |  | | | | data    ||| | |||  | |
</span><span style="color:#5c6a72;">| | | y |||  |    | | n ||| |r||| |||| |      |  | | | +---------+++ | |||  | |
</span><span style="color:#5c6a72;">| | +--+++   |    | | t ||| |e||| |||| |      |  | | +---------------+ |||  | |
</span><span style="color:#5c6a72;">| |          |    | +--+++  +-++  |||| |      |  | | | Text          | |||  | |
</span><span style="color:#5c6a72;">| |          |    |               |||| |      |  | | +---------------+ |||  | |
</span><span style="color:#5c6a72;">| +----------+    +---------------+++  |      |  | +------------------+++|  | |
</span><span style="color:#5c6a72;">|                                      |      |  +---------------------+++  | |
</span><span style="color:#5c6a72;">+--------------------------------------+      |  | Execution Stack     |||  | |
</span><span style="color:#5c6a72;">                                              |  | +---------+++       |||  | |
</span><span style="color:#5c6a72;">                                              |  | | Pointer ---------------+ |
</span><span style="color:#5c6a72;">                                              |  | +---------+++       |||    |
</span><span style="color:#5c6a72;">                                              |  +---------------------+++    |
</span><span style="color:#5c6a72;">                                              |  | Register Records    |||    |
</span><span style="color:#5c6a72;">                                              |  +---------------------+++    |
</span><span style="color:#5c6a72;">                                              +-------------------------------+</span></code></pre>
  
  <pre color-scheme="dark"><code><span style="color:#d3c6aa;">File:                                                 Memory:
</span><span style="color:#d3c6aa;">+--------------------------------------+      +-------------------------------+
</span><span style="color:#d3c6aa;">| Archive                              |      |  +--------------------++++    |
</span><span style="color:#d3c6aa;">| +----------+    +---------------+++  |      |  | Global Data Stack  ||||    |
</span><span style="color:#d3c6aa;">| | Global   | +-&gt;| Function Unit |||| |      |  |--------------------++++    |
</span><span style="color:#d3c6aa;">| | +--+++   | |  | +--+++  +-++  |||| |      |  | Text Vector           |    |
</span><span style="color:#d3c6aa;">| | | D |||  | |  | | T ||| |D||| |||| |      |  +-----------------------+    |
</span><span style="color:#d3c6aa;">| | | a |||  | |  | | e ||| |a||| ||||==========&gt;| Function Unit Vector  |&lt;-+ |
</span><span style="color:#d3c6aa;">| | | t |||  | |  | | x ||| |t||| |||| |      |  | +-------------------++|  | |
</span><span style="color:#d3c6aa;">| | | a |||  | |  | | t ||| |a||| |||| |      |  | | +---------------+ |||  | |
</span><span style="color:#d3c6aa;">| | +--+++   | |  | +--+++  +-++  |||| |      |  | | | Data Vector   | |||  | |
</span><span style="color:#d3c6aa;">| | +--+++   | |  | +--+++  +-++  |||| |      |  | | | +---------+++ | |||  | |
</span><span style="color:#d3c6aa;">| | | E |||  | |  | | C ||| |C||| |||| |      |  | | | | Literal ||| | |||  | |
</span><span style="color:#d3c6aa;">| | | n |||  | |  | | o ||| |l||| |||| |      |  | | | +---------+++ | |||  | |
</span><span style="color:#d3c6aa;">| | | t -------+  | | s ||| |o||| |||| |      |  | | | | capture ||| | |||  | |
</span><span style="color:#d3c6aa;">| | | e |||  |    | | t ||| |s||| |||| | Load |  | | | +---------+++ | |||  | |
</span><span style="color:#d3c6aa;">| | | r |||  |    | | a ||| |u||| |||| | ===&gt; |  | | | | data    ||| | |||  | |
</span><span style="color:#d3c6aa;">| | | y |||  |    | | n ||| |r||| |||| |      |  | | | +---------+++ | |||  | |
</span><span style="color:#d3c6aa;">| | +--+++   |    | | t ||| |e||| |||| |      |  | | +---------------+ |||  | |
</span><span style="color:#d3c6aa;">| |          |    | +--+++  +-++  |||| |      |  | | | Text          | |||  | |
</span><span style="color:#d3c6aa;">| |          |    |               |||| |      |  | | +---------------+ |||  | |
</span><span style="color:#d3c6aa;">| +----------+    +---------------+++  |      |  | +------------------+++|  | |
</span><span style="color:#d3c6aa;">|                                      |      |  +---------------------+++  | |
</span><span style="color:#d3c6aa;">+--------------------------------------+      |  | Execution Stack     |||  | |
</span><span style="color:#d3c6aa;">                                              |  | +---------+++       |||  | |
</span><span style="color:#d3c6aa;">                                              |  | | Pointer ---------------+ |
</span><span style="color:#d3c6aa;">                                              |  | +---------+++       |||    |
</span><span style="color:#d3c6aa;">                                              |  +---------------------+++    |
</span><span style="color:#d3c6aa;">                                              |  | Register Records    |||    |
</span><span style="color:#d3c6aa;">                                              |  +---------------------+++    |
</span><span style="color:#d3c6aa;">                                              +-------------------------------+</span></code></pre>
<p>In data status stored in file, the file includes following section:</p>
    <ul>
      <li>Global Data section: storing global variable data</li>
      <li>Global entry section: storing all entry points of data and function</li>
      <li>
        <p>Function Unit section: storing all function units Function Unit includes:</p>
        <ul>
          <li>Text section: storing instructions to be executed</li>
          <li>Data section: storing constants, variables used only in this function</li>
          <li>Constant section: storing immediate value used in this function</li>
          <li>Closure section: storing relocation information for captured variables</li>
        </ul>
      </li>
    </ul>
    <p>In memory, there are three segments:</p>
    <ul>
      <li>Global Data Stack: every function will share the same global data stack, used for variable storage, argument passing, etc. Global Data Stack works like normal stack in x86_64 assembly. Global Data Stack stores global variable data at initial, and then construct function frames when function called. A Global Data Stack can be at most 4 GiB size. The register <span style="display: inline-block;">

<code color-scheme="light"><span style="color:#5c6a72;">Reg#SS</span></code>
<code color-scheme="dark"><span style="color:#d3c6aa;">Reg#SS</span></code>
</span> points to the current used data stack segment base. The global data stack may be duplicated and stored in new data stack segment, when continuous, fork, extremely large stack allocation invoked. And the <span style="display: inline-block;">

<code color-scheme="light"><span style="color:#5c6a72;">Reg#SS</span></code>
<code color-scheme="dark"><span style="color:#d3c6aa;">Reg#SS</span></code>
</span> will be updated to point to new data stack segment base. It is also possible to use the data stack duplicate for snapshot purpose.</li>
      <li>Text Vector: Every function's text segment is loaded into text vector. Text Vector stores all text segments in the program.</li>
      <li>
        <p>Function Unit Vector: every function has its own function unit, including text segment and data segment Function Unit Vector stores all function units in the program. Function Unit Vector maps function index to function unit, a pointer points to corresponding function unit in function unit. If a Function unit is not be referenced by any pointer, the slot for the function unit is freed and can be reused. Function Unit includes:</p>
        <ul>
          <li>Text Segment: A pointer points to text segment in text vector.</li>
          <li>
            <p>Data Segment: every function have its own data segment, storing literal data and captured data, which are pointers to global data stack.</p>
            <ul>
              <li>Literal Section: literal are constant may used in function or for instruction parameter, not able to be embedded in instruction directly.</li>
              <li>Capture Section: Captured data are pointers, points to global data stack or heap data. Every pointer must be pushed into capture section and deleted when the function does not hold it. If the parameter is a captured pointer, the pointer must be pushed into capture section. No pointer is allowed to be stored in global data stack except argument passing area.</li>
              <li>Data Section: other data used in function.</li>
            </ul>
          </li>
        </ul>
        <p>Literal Section is loaded from file into data segment directly. Capture Section is constructed when function unit constructed. Data section is loaded from file into data segment directly.</p>
      </li>
      <li>Execution Stack: every function call will push a pointer points to corresponding function unit in function unit vector into execution stack. Execution stack stores function call frame pointer. The Execution Stack can be duplicated and stored in new execution stack segment, when continuous, fork invoked. And the <span style="display: inline-block;">

<code color-scheme="light"><span style="color:#5c6a72;">Reg#ES</span></code>
<code color-scheme="dark"><span style="color:#d3c6aa;">Reg#ES</span></code>
</span> will be updated to point to new execution stack segment.</li>
      <li>Register Records: The register records store all register values, and will change the value as instructions executed. Register records will be saved and restored with snapshot exception handling invoked.</li>
    </ul>
 
        </details>
      </section>
      
    


    </article>
    
    <nav id="toc">
        <div class="block">
            <h1>Table of Contents</h1>
            <ul class="block">
            

  <li class="item-summary">
    <a class="bullet">■</a>
    <span class="link"><a href="#notes/d_flat/Turing/Overview">
<span id="notes/d_flat/Turing/Overview"></span>
Architecture Overview</a></span>
    <ul class="block" style="display: block;">
      
    </ul>
  </li>


            </ul>
        </div>
    </nav>
 
  </div>


</body>
</html>